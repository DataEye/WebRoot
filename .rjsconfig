/**
 * r.js资源优化配置文件
 * 执行： node tools\node_modules\requirejs\bin\r.js -o .rjsconfig
 */

{
  // 资源文件开发目录
  appDir: 'assets',

  // 资源文件打包输出目录
  dir: 'assets-build',

  // 开发脚本目录
  baseUrl: 'js',

  // 是否优化css，standard/none
  optimizeCss: "standard",

  // 是否生成source map
  // see http://requirejs.org/docs/optimization.html#sourcemaps
  generateSourceMaps: true,

  // 是否保留开源协议声明
  preserveLicenseComments: false,

  // 是否优化JS，uglify2/none
  optimize: 'none',

  // 合并后是否移除单个子文件
  removeCombined: true,

  // TODO modules配置没有生效
  findNestedDependencies: false,

  // build预处理，暂未使用
  onBuildRead: function (moduleName, path, contents) {
    return contents
  },

  // build预处理，暂未使用
  onBuildWrite: function (moduleName, path, contents) {
    return contents
  },

  // 两种常用情况：
  // 1) 和requirejs一样的路径别名功能
  // 2) 指定modules配置里面新生成文件({create: true})的输出路径
  paths: {
    'app': './app',
    'app-base': './app-base',
    'core-base': './core-base',
    'components': './components',
    // 这个是别名，上面几个对应modules里面的模块输出
    'tpl': '../../tpl'
  },

  // 兼容非AMD规范的模块定义
  shim: {
    'highcharts': {
      exports: 'Highcharts'
    },
    'highcharts-3d': {
      deps: ['highcharts']
    }
  },

  // build阶段需要忽略的插件，常用于统一开发和生产阶段的开发模式
  // 比如require(['text!a.html'])，开发阶段直接使用请求加载a.html
  // 生产环境r.js会定义a.html这个模块，输出为a.html文件内容的字符串
  stubModules: ['text'],

  // 模块合并打包配置
  modules: [
    {
      // 基础库
      name: 'core-base',
      create: true,
      include: [
        'raf',
        'ractive',
        'rvc',
        'router',
        'jquery',
        'jquery.cookie',
        'jquery.amaran',
        'jquery-scrolltofixed',
        'query-string',
        'store',
        'lodash', // lodash compat
        'moment',
        'mustache',
        'numeral',
        'tween',
        'md5'
      ]
    },
    {
      // 业务辅助类
      name: 'app-base',
      create: true,
      include: [
        'spa',
        'utils',
        'oss'
      ],
      exclude: [
        'core-base'
      ]
    },
    {
      // 组件库
      name: 'components',
      create: true,
      include: [
        'bootstrap/colorpicker',
        'bootstrap/popover',
        'bootstrap/timepicker',
        'bootstrap/tooltip',
        'components/ajax-button'
        // TODO 补齐其它组件
      ],
      // 排除依赖脚本
      exclude: [
        'core-base',
        'app-base'
      ]
    },
    // TODO 国际化
    {
      // 业务图表库
      name: 'charts',
      include: [
        'highcharts',
        'highcharts-3d'
      ],
      exclude: [
        'core-base',
        'app-base'
      ]
    },
    {
      // app需要国际化
      name: 'app',
      create: true,
      include: [
        // TODO 补齐其它业务脚本
        'app/main',
        'app/sample'
      ],
      exclude: [
        'core-base',
        'app-base'
      ]
    }
    // TODO 国际化
  ]
}
